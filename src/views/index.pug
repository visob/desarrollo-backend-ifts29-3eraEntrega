doctype html
html(lang='es')
  head
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    title= title
    link(rel='stylesheet', href='https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap')
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css')
    include partials/layoutStyles.pug
    include partials/headerModule.pug
    style.
      .top-grid {
        display:grid;
        grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
        gap: 16px;
        margin-top: 22px;
      }

      .metric-card {
        background: linear-gradient(135deg, rgba(239,250,255,0.9), rgba(221,238,255,0.9));
        padding: 18px;
        border-radius: 12px;
        display:flex;
        align-items:center;
        justify-content: space-between;
        border: 1px solid rgba(12,50,80,0.04);
      }

      .metric-left {
        display:flex;
        gap:12px;
        align-items:center;
      }
      .metric-icon {
        width:48px;
        height:48px;
        border-radius:10px;
        display:flex;
        align-items:center;
        justify-content:center;
        background: rgba(11,117,182,0.1);
        color: #0f4c81;
        font-size:1.3em;
      }
      .metric-title { font-size:0.85em; color: #5b7f98; margin:0; }
      .metric-number { font-size:1.6rem; font-weight:700; color: #0f4c81; margin:0; }

      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-top: 28px;
      }

      .info-card {
        background: white;
        padding: 14px;
        border-radius: 12px;
        box-shadow: 0 8px 22px rgba(12,50,80,0.04);
      }

      .info-card h3 {
        margin: 0 0 10px 0;
        font-size: 1rem;
        color: #0f4c81;
        display:flex;
        align-items:center;
        gap:10px;
      }

      ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      li {
        background: linear-gradient(180deg, #ffffff, #fbfdff);
        border-radius: 10px;
        margin-bottom: 10px;
        padding: 10px 12px;
        border: 1px solid rgba(10,60,100,0.03);
      }

      /* Cards grid para turnos y pacientes */
      .cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 12px;
        margin-top: 8px;
      }

      .card {
        background: linear-gradient(180deg, #ffffff, #fbfdff);
        border-radius: 12px;
        padding: 12px;
        border: 1px solid rgba(10,60,100,0.06);
        box-shadow: 0 8px 20px rgba(12,50,80,0.04);
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .card-header {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #0f4c81;
        font-weight: 600;
      }

      .card-title {
        font-size: 0.95rem;
        margin: 0;
      }

      .card-body p {
        margin: 4px 0;
        color: #5b7f98;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .card i {
        color: #0f4c81;
      }

  body
    include partials/sidebar.pug
    +sidebar(user)

    .main
      .container
        +pageHeader(user, 'Dashboard')

        .top-grid
          .metric-card
            .metric-left
              .metric-icon
                i.fas.fa-calendar-check
              .metric-data
                p.metric-title Turnos (últ. 7 días)
                p.metric-number= metrics.turnos
          .metric-card
            .metric-left
              .metric-icon
                i.fas.fa-user-injured
              .metric-data
                p.metric-title Pacientes registrados
                p.metric-number= metrics.pacientes
          .metric-card
            .metric-left
              .metric-icon
                i.fas.fa-user-md
              .metric-data
                p.metric-title Médicos activos
                p.metric-number= metrics.medicos

        .info-grid
          .info-card
            h3
              i.fas.fa-list-ul
              | Turnos agendados recientemente
            if turnos.length
              .cards-grid
                each t in turnos
                  .card
                    .card-header
                      i.fas.fa-calendar-check
                      .card-title= `${t.fechaFormateada} ${t.HoraInicio || ''} - ${t.HoraFin || ''}`
                    .card-body
                      p
                        i.fas.fa-user
                        | Paciente: #{t.Paciente}
                      p
                        i.fas.fa-user-md
                        | Médico: #{t.Medico}
            if !turnos.length
              p No hay turnos recientes

          .info-card
            h3
              i.fas.fa-users
              | Pacientes registrados recientemente
            if pacientes.length
              .cards-grid
                each p in pacientes
                  .card
                    .card-header
                      i.fas.fa-id-card
                      .card-title= `${p.Nombre || p.nombre} ${p.Apellido || p.apellido}`
                    .card-body
                      p
                        i.fas.fa-id-badge
                        | DNI: #{p.DNI || p.dni || '-'}
                      p
                        i.fas.fa-file-medical
                        | Obra Social: #{p.ObraSocial || p.obraSocial || '-'}
            if !pacientes.length
              p No hay pacientes registrados